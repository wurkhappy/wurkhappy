{% extends "../base.html" %}



### Redefine the main block
{% block main %}


{% set slug = { "_xsrf": data['_xsrf'], "preFill": {}} %}

{% module Slug(slug) %}


<div class="container">
	{% block navigation %}
	{% end %}

	{% block header %}
	{% end %}

	<div id="content" class="clear">
		{% set otherUser = data[data['other']] %}

		<div id="agreement-profile" class="data-table">
			<table border="0" cellspacing="0" cellpadding="0">
				<tr>
					<td class="meta">
						<span><img src="{% raw otherUser['profileURL'][0] %}" width="50"></span>
					</td>
					<td>
						<h3><a href="detail.html">{{ otherUser['fullName'] }}</a></h3>
						<p>{{ otherUser['email'] }} {% if otherUser['telephone'] %} &mdash; {{ otherUser['telephone'] }}{% end %}</p>
					</td>
				</tr>
			</table>
		</div>

		<div id="payment-schedule" class="clear">
			<h2>Payment Schedule for {{ data['amount'] }}</h2>
			<ul>
				{% for num, phase in enumerate(data['phases'], 1) %}
					<li>
						{% if phase['dateCompleted'] %}<span>Completed {{ phase['dateCompleted'].strftime('%B %d, %Y') }}</span>{% end %}
						<strong>{{ phase['amount'] }}</strong> &mdash; Phase {{ str(num) }}{% if phase['estDateCompleted'] %} on {{ phase['estDateCompleted'].strftime('%B %d, %Y') }}{% end %}
					</li>
				{% end %}
			</ul>
		</div>

		<form id="comments-form" class="invisible">

		<div class="column-three-fourth">
			<h2>Summary</h2>
			{% if data['summary'] %}
				<p>{{ data['summary'] }}</p>
			{% else %}
				<p>&mdash;</p>
			{% end %}

			{% if data['self'] == 'client' and (data['state'] == 'EstimateState' or data['state'] == 'CompletedState') %}
				<div class="add notes">
					<p>Add comments and feedback on the agreement here.</p>
					<textarea name="summaryComments" rows="5" cols="80" placeholder="Add comments and feedback on the agreement here. You can also comment on specific phases below.">{{ data['summaryComments'] }}</textarea>
				</div>
			{% elif data['summaryComments'] %}
				<div class="notes">
				  <p>{% raw escape(data['summaryComments']).replace('\n', '<br/>') %}</p>
				</div>
			{% end %}
		</div>

		<!-- Listing of agreement's phases -->

		{% for num, phase in enumerate(data['phases'], 1) %}
			<div class="clear column-three-fourth">
				<h2 class="steps">
					Phase {{ str(num) }} ({{ phase['amount'] }})
					{% if phase['dateCompleted'] %}
						<span style="color: green">Completed {{ phase['dateCompleted'].strftime('%B %d, %Y') }}</span>
					{% elif phase['estDateCompleted'] %}
						<span>Estimated completion on {{ phase['estDateCompleted'].strftime('%B %d, %Y') }}</span>
					{% end %}
				</h2>

				<p>{{ phase['description'] }}</p>

				{% if data['self'] == 'client' and (data['state'] == 'EstimateState' or data['state'] == 'CompletedState') %}
					<div class="add notes">
						<p>Add comments and feedback on the agreement here.</p>
						<textarea name="phaseComments" rows="5" cols="80" placeholder="Add comments and feedback for Phase {{ str(num) }} here.">{{ phase.get('comments') or '' }}</textarea>
					</div>
				{% elif 'comments' in phase %}
					<div class="notes">
						<p>{% raw escape(phase['comments']).replace('\n', '<br/>') %}</p>
					</div>
				{% end %}
			</div>
		{% end %}

		<div id="agreement-history" class="clear">
			<h2>Agreement History</h2>
			<ul>
				{% for transaction in data['transactions'] %}
					{% block transactionitem %}
					{% end %}
				{% end %}
			</ul>
		</div>

		</form>
	</div>

	{% block footer %}
	{% end %}
</div>
{% end %}



### Component blocks included from above

{% block navigation %}
	<div id="navigation" class="clear">

		<div class="column-one-half">

			<ul class="clear">
				<li{% if data['self'] == 'vendor' %} class="current"{% end %}><a href="/agreements/with/clients"><strong>Client Agreements</strong></a></li>
				<li{% if data['self'] == 'client' %} class="current"{% end %}><a href="/agreements/with/vendors"><strong>Vendor Agreements</strong></a></li>
				<li><a href="/people"><strong>People</strong></a></li>
			</ul>

		</div>

		<div class="column-one-half">

			<ul id="admin" class="clear">
				<li><a href="/logout">Log Out</a></li>
				<li><a href="/user/me/account">Account</a></li>
				<li><a href="/admin/preferences">Preferences</a></li>
			</ul>

		</div>

	</div>
{% end %}



{% block header %}
	<div id="intro" class="clear">

		<div class="column-three-fourth">

			<h1>{{ data['name'] }}</h1>
			<p>{% if len(data['transactions']) %}
				{% set transaction = data['transactions'][-1] %}
				<span>Latest Activity:</span> {{ transaction['type'] }} {{ data[transaction['user']]['fullName'] }} on {{ transaction['date'] }}
			{% else %}
				<span>This draft has not been sent.</span>
			{% end %}
			</p>

		</div>
		<div class="column-one-fourth">

			<ul class="action-button">
			{% for action in data['actions'] %}
				<li><a href="#" id="{{ action['id'] }}" class="top"><span>{{ action['name'] }}</span></a></li>
			{% end %}
			</ul>

		</div>

	</div>
{% end %}

{% block scripts-custom %}
	<script language="javascript">
		var buttonMaps = [
{% for action in data['actions'] %}
			{% raw json(action) %},
{% end %}];
	</script>
	<script src="{{ static_url("scripts/libs/jquery-autosuggest-1.4.js") }}" type="text/javascript"></script>
	<script src="{{ static_url("scripts/application.js") }}"></script>
{% end %}



{% block transactionitem %}
				<li>{{ transaction['type'] }} <a href="/people/{{ data[transaction['user']]['id'] }}">{{ data[transaction['user']]['fullName'] }}</a> on {{ transaction['date'] }}</li>
{% end %}



{% block footer %}
	<div id="footer" class="clear">
		<div class="column-one-fourth">
			<h3>Archives</h3>
			<ul>
				<li><a href="">All Client Agreements</a></li>
				<li><a href="">All Vendor Agreements</a></li>
				<li><a href="">All People</a></li>
			</ul>
		</div>

		<div class="column-one-fourth">
			<h3>Section 2</h3>
			<ul>
				<li><a href="#">Links</a></li>
				<li><a href="#">Links</a></li>
				<li><a href="#">Links</a></li>
			</ul>
		</div>

		<div class="column-one-fourth">
			<h3>Section 3</h3>
			<ul>
				<li><a href="#">Links</a></li>
				<li><a href="#">Links</a></li>
				<li><a href="#">Links</a></li>
			</ul>
		</div>

		<div class="column-one-fourth">
			<h3>Section 4</h3>
			<ul>
				<li><a href="#">Links</a></li>
				<li><a href="#">Links</a></li>
				<li><a href="#">Links</a></li>
			</ul>
		</div>
	</div>

	<div id="copyright" class="clear">
		<p>Powered by Wurk Happy &bull; Copyright &#169; Wurk Happy. All rights reserved.</p>
	</div>
{% end %}
